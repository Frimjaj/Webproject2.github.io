<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Персональный дашборд организатора</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #a5b4fc;
            --secondary-color: #10b981;
            --accent-color: #8b5cf6;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
            
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            
            --border-color: #334155;
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --border-radius-lg: 24px;
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.3);
            --shadow-inner: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-secondary: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-card: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
            --gradient-bg: radial-gradient(ellipse at top, #1e293b 0%, #0f172a 100%);
            
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
            --transition-slow: 350ms ease;
        }

        body {
            background: var(--gradient-bg);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }

        /* Header */
        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: var(--gradient-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .dashboard-header h1 {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .dashboard-header p {
            color: var(--text-secondary);
            font-size: 1.15rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 40px;
            padding: 25px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .btn {
            padding: 14px 28px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: left var(--transition-base);
            z-index: 0;
        }

        .btn:hover::before {
            left: 0;
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn i {
            position: relative;
            z-index: 1;
        }

        .btn:hover {
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-danger {
            background: var(--bg-secondary);
        }

        .btn-danger::before {
            background: var(--gradient-danger);
        }

        .btn-success {
            background: var(--bg-secondary);
        }

        .btn-success::before {
            background: var(--gradient-secondary);
        }

        /* Widgets Grid */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        /* Widget Base Styles */
        .widget {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: all var(--transition-base);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .widget:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity var(--transition-base);
            z-index: 0;
        }

        .widget:hover::before {
            opacity: 0.05;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 1px solid var(--border-color);
            position: relative;
            z-index: 1;
        }

        .widget-title {
            font-size: 1.35rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .widget-title i {
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .widget-controls {
            display: flex;
            gap: 8px;
        }

        .widget-control-btn {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: var(--primary-color);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            backdrop-filter: blur(5px);
        }

        .widget-control-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .widget-body {
            padding: 30px;
            position: relative;
            z-index: 1;
        }

        /* Minimized State */
        .widget.minimized .widget-body {
            display: none;
        }

        .widget.minimized {
            max-width: 320px;
        }

        /* ToDo Widget Specific */
        .todo-input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .todo-input {
            flex: 1;
            padding: 15px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .todo-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .todo-input::placeholder {
            color: var(--text-muted);
        }

        .todo-list {
            list-style: none;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .todo-list::-webkit-scrollbar {
            width: 6px;
        }

        .todo-list::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .todo-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 18px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all var(--transition-base);
            border: 1px solid transparent;
        }

        .todo-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-color);
            transform: translateX(5px);
        }

        .todo-item.completed {
            opacity: 0.6;
            background: rgba(16, 185, 129, 0.1);
        }

        .todo-checkbox {
            margin-right: 15px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--success-color);
            transform: scale(1.1);
        }

        .todo-text {
            flex: 1;
            font-size: 1.05rem;
            color: var(--text-primary);
        }

        .todo-text.completed {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .todo-delete {
            background: rgba(239, 68, 68, 0.1);
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .todo-delete:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: scale(1.1);
        }

        .todo-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Quote Widget Specific */
        .quote-container {
            text-align: center;
            padding: 20px 0;
        }

        .quote-text {
            font-size: 1.4rem;
            font-style: italic;
            line-height: 1.7;
            margin-bottom: 20px;
            color: var(--text-primary);
            position: relative;
            padding: 0 30px;
            font-weight: 500;
        }

        .quote-text:before, .quote-text:after {
            content: '"';
            font-size: 4rem;
            color: var(--primary-color);
            position: absolute;
            opacity: 0.2;
            font-weight: 700;
        }

        .quote-text:before {
            top: -25px;
            left: 0;
        }

        .quote-text:after {
            bottom: -40px;
            right: 0;
        }

        .quote-author {
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 15px;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quote-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        /* Weather Widget */
        .weather-container {
            text-align: center;
        }

        .weather-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            margin-bottom: 25px;
        }

        .weather-temp {
            font-size: 4rem;
            font-weight: 800;
            color: var(--text-primary);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .weather-details {
            text-align: left;
        }

        .weather-city {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .weather-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .weather-extra {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        .weather-extra-item {
            text-align: center;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            transition: all var(--transition-fast);
        }

        .weather-extra-item:hover {
            transform: translateY(-3px);
            background: var(--bg-card-hover);
        }

        .weather-extra-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .weather-extra-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* News Widget */
        .news-container {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .news-container::-webkit-scrollbar {
            width: 6px;
        }

        .news-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .news-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        .news-item {
            padding: 22px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all var(--transition-base);
            border: 1px solid transparent;
        }

        .news-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-color);
            transform: translateX(5px);
        }

        .news-item:last-child {
            margin-bottom: 0;
        }

        .news-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1.15rem;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .news-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .news-source {
            font-size: 0.85rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Empty State */
        .empty-dashboard {
            text-align: center;
            padding: 80px 40px;
            background: var(--gradient-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            margin-top: 40px;
            border: 2px dashed var(--border-color);
            backdrop-filter: blur(10px);
        }

        .empty-icon {
            font-size: 5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 25px;
            opacity: 0.5;
        }

        .empty-text {
            color: var(--text-primary);
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .empty-dashboard p {
            color: var(--text-secondary);
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Footer */
        .dashboard-footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 60px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-card);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
        }

        .dashboard-footer p {
            margin-bottom: 10px;
        }

        .stats-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--bg-secondary);
            padding: 12px 24px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Help Icon */
        .help-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-base);
            z-index: 1000;
            border: none;
        }

        .help-icon:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .widgets-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .widgets-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .dashboard-header h1 {
                font-size: 2.2rem;
            }
            
            .stats-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .help-icon {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .dashboard-header {
                padding: 30px 20px;
            }
            
            .widget-header, .widget-body {
                padding: 20px;
            }
            
            .weather-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .weather-details {
                text-align: center;
            }
        }

        /* Animation for new widgets */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .widget.new {
            animation: slideIn 0.5s ease forwards;
        }

        /* Loading animation */
        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Drag and drop indicators */
        .widget.dragging {
            opacity: 0.5;
            border: 2px dashed var(--primary-color);
        }

        .drop-zone {
            border: 2px dashed var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1><i class="fas fa-sparkles"></i> Персональный организатор</h1>
            <p>Ваш централизованный дашборд для управления задачами, вдохновения и получения важной информации</p>
        </header>

        <div class="controls">
            <button class="btn" id="addTodoBtn">
                <i class="fas fa-tasks"></i> <span>Добавить список дел</span>
            </button>
            <button class="btn" id="addQuoteBtn">
                <i class="fas fa-quote-right"></i> <span>Добавить цитаты</span>
            </button>
            <button class="btn btn-success" id="addWeatherBtn">
                <i class="fas fa-cloud-sun"></i> <span>Добавить погоду</span>
            </button>
            <button class="btn" id="addNewsBtn">
                <i class="fas fa-newspaper"></i> <span>Добавить новости</span>
            </button>
            <button class="btn btn-danger" id="removeAllBtn">
                <i class="fas fa-trash-alt"></i> <span>Удалить все виджеты</span>
            </button>
            <button class="btn" id="saveDashboardBtn">
                <i class="fas fa-camera"></i> <span>Сохранить дашборд</span>
            </button>
        </div>

        <div class="widgets-grid" id="widgetsContainer">
            <!-- Виджеты будут добавляться сюда -->
        </div>

        <div class="empty-dashboard" id="emptyState" style="display: none;">
            <div class="empty-icon">
                <i class="fas fa-th-large"></i>
            </div>
            <h2 class="empty-text">Нет активных виджетов</h2>
            <p>Добавьте виджеты с помощью панели управления выше, чтобы начать работу</p>
        </div>

        <footer class="dashboard-footer">
            <p>Персональный дашборд организатора &copy; 2023 | Создано с использованием принципов ООП</p>
            <div class="stats-info">
                <div class="stat-item">
                    <strong>Всего виджетов:</strong> <span id="widgetCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <strong>Виджеты с API:</strong> <span class="stat-value">Погода, Новости</span>
                </div>
                <div class="stat-item">
                    <strong>Состояние:</strong> <span class="stat-value" id="dashboardStatus">Активно</span>
                </div>
            </div>
        </footer>
    </div>

    <button class="help-icon" id="helpBtn" title="Подсказки">
        <i class="fas fa-question"></i>
    </button>
    <script>
        // Базовый класс для всех UI компонентов
        class UIComponent {
            constructor(config) {
                this.id = config.id || `widget-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                this.title = config.title || 'Виджет';
                this.icon = config.icon || 'fas fa-cube';
                this.isMinimized = false;
                this.element = null;
                this.eventListeners = [];
            }

            // Создание DOM-элемента виджета
            render() {
                this.element = document.createElement('div');
                this.element.className = 'widget';
                this.element.id = this.id;
                
                this.element.innerHTML = `
                    <div class="widget-header">
                        <div class="widget-title">
                            <i class="${this.icon}"></i>
                            <span>${this.title}</span>
                        </div>
                        <div class="widget-controls">
                            <button class="widget-control-btn minimize-btn" title="Свернуть">
                                <i class="fas ${this.isMinimized ? 'fa-expand' : 'fa-minus'}"></i>
                            </button>
                            <button class="widget-control-btn close-btn" title="Закрыть">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="widget-body">
                        ${this.renderBody()}
                    </div>
                `;
                
                // Добавляем класс для анимации появления
                this.element.classList.add('new');
                setTimeout(() => {
                    this.element.classList.remove('new');
                }, 500);
                
                // Добавляем обработчики событий
                this.bindEvents();
                
                return this.element;
            }

            // Метод для отрисовки содержимого (должен быть переопределен в дочерних классах)
            renderBody() {
                return '<p>Базовый виджет</p>';
            }

            // Привязка обработчиков событий
            bindEvents() {
                const minimizeBtn = this.element.querySelector('.minimize-btn');
                const closeBtn = this.element.querySelector('.close-btn');
                
                if (minimizeBtn) {
                    this.addListener(minimizeBtn, 'click', () => this.toggleMinimize());
                }
                if (closeBtn) {
                    this.addListener(closeBtn, 'click', () => this.destroy());
                }
            }

            // Метод для добавления обработчика с отслеживанием
            addListener(element, event, handler) {
                if (element) {
                    element.addEventListener(event, handler);
                    this.eventListeners.push({ element, event, handler });
                }
            }

            // Свернуть/развернуть виджет
            toggleMinimize() {
                this.isMinimized = !this.isMinimized;
                const widgetBody = this.element.querySelector('.widget-body');
                const minimizeIcon = this.element.querySelector('.minimize-btn i');
                
                if (this.isMinimized) {
                    widgetBody.style.display = 'none';
                    minimizeIcon.className = 'fas fa-expand';
                } else {
                    widgetBody.style.display = 'block';
                    minimizeIcon.className = 'fas fa-minus';
                }
                
                this.element.classList.toggle('minimized');
            }

            // Удаление виджета
            destroy() {
                // Удаляем все обработчики событий
                this.eventListeners.forEach(listener => {

                    if (listener.element && listener.handler) {
                        listener.element.removeEventListener(listener.event, listener.handler);
                    }
                });
                
                // Анимация удаления
                if (this.element) {
                    this.element.style.transform = 'scale(0.9)';
                    this.element.style.opacity = '0';
                    
                    setTimeout(() => {
                        // Удаляем элемент из DOM
                        if (this.element && this.element.parentNode) {
                            this.element.parentNode.removeChild(this.element);
                        }
                        
                        // Оповещаем дашборд об удалении
                        if (this.onDestroy) {
                            this.onDestroy(this.id);
                        }
                    }, 300);
                }
            }

            // Обновление содержимого виджета
            update() {
                const widgetBody = this.element?.querySelector('.widget-body');
                if (widgetBody) {
                    widgetBody.innerHTML = this.renderBody();
                    this.bindEvents();
                }
            }
        }

        // Виджет списка дел
        class ToDoWidget extends UIComponent {
            constructor(config) {
                super({
                    id: config.id,
                    title: config.title || 'Мои задачи',
                    icon: 'fas fa-tasks'
                });
                
                this.tasks = config.tasks || [];
                this.nextTaskId = config.nextTaskId || 1;
            }

            renderBody() {
                if (this.tasks.length === 0) {
                    return `
                        <div class="todo-empty">
                            <p>Нет задач. Добавьте первую!</p>
                        </div>
                        <div class="todo-input-container">
                            <input type="text" class="todo-input" placeholder="Введите новую задачу...">
                            <button class="btn add-todo-btn">
                                <i class="fas fa-plus"></i> <span>Добавить</span>
                            </button>
                        </div>
                    `;
                }

                const tasksHtml = this.tasks.map(task => `
                    <li class="todo-item ${task.completed ? 'completed' : ''}" data-id="${task.id}">
                        <input type="checkbox" class="todo-checkbox" ${task.completed ? 'checked' : ''}>
                        <span class="todo-text ${task.completed ? 'completed' : ''}">${task.text}</span>
                        <button class="todo-delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </li>
                `).join('');

                return `
                    <div class="todo-input-container">
                        <input type="text" class="todo-input" placeholder="Введите новую задачу...">
                        <button class="btn add-todo-btn">
                            <i class="fas fa-plus"></i> <span>Добавить</span>
                        </button>
                    </div>
                    <ul class="todo-list">
                        ${tasksHtml}
                    </ul>
                `;
            }

            bindEvents() {
                super.bindEvents();
                
                const todoInput = this.element?.querySelector('.todo-input');
                const addBtn = this.element?.querySelector('.add-todo-btn');
                
                // Добавление новой задачи
                const addTask = () => {
                    const text = todoInput?.value.trim();
                    if (text) {
                        this.addTask(text);
                        todoInput.value = '';
                        todoInput.focus();
                    }
                };
                
                if (addBtn) {
                    this.addListener(addBtn, 'click', addTask);
                }
                
                if (todoInput) {
                    this.addListener(todoInput, 'keypress', (e) => {
                        if (e.key === 'Enter') addTask();
                    });
                }
                
                // Делегирование событий для списка задач
                const todoList = this.element?.querySelector('.todo-list');
                if (todoList) {
                    this.addListener(todoList, 'click', (e) => {
                        const todoItem = e.target.closest('.todo-item');
                        if (!todoItem) return;
                        
                        const taskId = parseInt(todoItem.dataset.id);
                        
                        // Удаление задачи
                        if (e.target.closest('.todo-delete')) {
                            this.removeTask(taskId);
                        }
                        // Отметка как выполненной
                        else if (e.target.classList.contains('todo-checkbox')) {
                            this.toggleTask(taskId);
                        }
                    });
                }
            }

            addTask(text) {
                const newTask = {
                    id: this.nextTaskId++,
                    text: text,
                    completed: false,
                    createdAt: new Date()
                };
                
                this.tasks.push(newTask);
                this.update();
            }

            removeTask(taskId) {
                this.tasks = this.tasks.filter(task => task.id !== taskId);
                this.update();
            }

            toggleTask(taskId) {
                const task = this.tasks.find(task => task.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    this.update();
                }
            }

            // Получение данных для сохранения состояния
            getState() {
                return {
                    type: 'todo',
                    tasks: this.tasks,
                    nextTaskId: this.nextTaskId
                };
            }
        }

        // Виджет цитат
        class QuoteWidget extends UIComponent {
            constructor(config) {
                super({
                    id: config.id,
                    title: config.title || 'Цитата дня',
                    icon: 'fas fa-quote-right'
                });
                
                this.quotes = config.quotes || [
                    { text: "Единственный способ сделать великую работу — любить то, что вы делаете.", author: "Стив Джобс" },
                    { text: "Будущее принадлежит тем, кто верит в красоту своей мечты.", author: "Элеонора Рузвельт" },
                    { text: "Успех — это способность идти от неудачи к неудаче, не теряя энтузиазма.", author: "Уинстон Черчилль" },
                    { text: "Лучший способ предсказать будущее — создать его.", author: "Питер Друкер" },
                    { text: "Не бойтесь отказываться от хорошего в пользу отличного.", author: "Джим Коллинз" }
                ];
                
                this.currentQuoteIndex = config.currentQuoteIndex || Math.floor(Math.random() * this.quotes.length);
            }

            renderBody() {
                const quote = this.quotes[this.currentQuoteIndex];
                
                return `
                    <div class="quote-container">
                        <div class="quote-text">${quote.text}</div>
                        <div class="quote-author">— ${quote.author}</div>
                        <button class="btn" style="margin-top: 25px;">
                            <i class="fas fa-sync-alt"></i> <span>Новая цитата</span>
                        </button>
                    </div>
                `;
            }

            bindEvents() {
                super.bindEvents();
                
                const refreshBtn = this.element?.querySelector('.btn');
                if (refreshBtn) {
                    this.addListener(refreshBtn, 'click', () => this.refreshQuote());
                }
            }

            refreshQuote() {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * this.quotes.length);
                } while (newIndex === this.currentQuoteIndex && this.quotes.length > 1);
                
                this.currentQuoteIndex = newIndex;
                this.update();
            }

            getState() {
                return {
                    type: 'quote',
                    currentQuoteIndex: this.currentQuoteIndex,
                    quotes: this.quotes
                };
            }
        }

        // Виджет погоды (использует сторонний API)
        class WeatherWidget extends UIComponent {
            constructor(config) {
                super({
                    id: config.id,
                    title: config.title || 'Погода',
                    icon: 'fas fa-cloud-sun'
                });
                
                this.city = config.city || 'Москва';
                this.weatherData = config.weatherData || null;
                this.isLoading = false;
            }

            renderBody() {
                if (this.isLoading) {
                    return `
                        <div class="quote-loading">
                            <p><i class="fas fa-spinner fa-spin spinner"></i> Загрузка погоды...</p>
                        </div>
                    `;
                }
                
                if (!this.weatherData) {
                    return `
                        <div class="weather-container">
                            <p>Загрузка данных о погоде...</p>
                            <button class="btn" style="margin-top: 15px;">
                                <i class="fas fa-sync-alt"></i> <span>Обновить</span>
                            </button>
                        </div>
                    `;
                }
                
                const { temp, feels_like, humidity, pressure, description, city } = this.weatherData;
                
                return `
                    <div class="weather-container">
                        <div class="weather-info">
                            <div class="weather-temp">${Math.round(temp)}°C</div>
                            <div class="weather-details">
                                <div class="weather-city">${city}</div>
                                <div class="weather-description">${description}</div>
                                <div>Ощущается как: ${Math.round(feels_like)}°C</div>
                            </div>
                        </div>
                        <div class="weather-extra">
                            <div class="weather-extra-item">
                                <div class="weather-extra-value">${humidity}%</div>
                                <div class="weather-extra-label">Влажность</div>
                            </div>
                            <div class="weather-extra-item">
                                <div class="weather-extra-value">${pressure} hPa</div>
                                <div class="weather-extra-label">Давление</div>
                            </div>
                        </div>
                        <button class="btn" style="margin-top: 20px;">
                            <i class="fas fa-sync-alt"></i> <span>Обновить погоду</span>
                        </button>
                    </div>
                `;
            }

            bindEvents() {
                super.bindEvents();
                
                const refreshBtn = this.element?.querySelector('.btn');
                if (refreshBtn) {
                    this.addListener(refreshBtn, 'click', () => this.fetchWeather());
                }
                
                // Загружаем погоду при создании виджета
                if (!this.weatherData) {
                    this.fetchWeather();
                }
            }

            async fetchWeather() {
                this.isLoading = true;
                this.update();
                
                try {
                    // Используем OpenWeatherMap API (замените на свой API ключ)
                    // Для демонстрации используем мок-данные
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // Мок-данные для демонстрации (в реальном приложении здесь был бы fetch запрос)
                    const mockWeatherData = {
                        temp: 18 + Math.floor(Math.random() * 10),
                        feels_like: 16 + Math.floor(Math.random() * 10),
                        humidity: 50 + Math.floor(Math.random() * 30),
                        pressure: 1010 + Math.floor(Math.random() * 20),
                        description: ['Ясно', 'Облачно', 'Небольшой дождь', 'Пасмурно'][Math.floor(Math.random() * 4)],
                        city: this.city
                    };
                    
                    this.weatherData = mockWeatherData;
                } catch (error) {
                    console.error('Ошибка загрузки погоды:', error);
                    this.weatherData = {
                        temp: 0,
                        feels_like: 0,
                        humidity: 0,
                        pressure: 0,
                        description: 'Ошибка загрузки',
                        city: this.city
                    };
                } finally {
                    this.isLoading = false;
                    this.update();
                }
            }

            getState() {
                return {
                    type: 'weather',
                    city: this.city,
                    weatherData: this.weatherData
                };
            }
        }

        // Виджет новостей (использует сторонний API)
        class NewsWidget extends UIComponent {
            constructor(config) {
                super({
                    id: config.id,
                    title: config.title || 'Последние новости',
                    icon: 'fas fa-newspaper'
                });
                
                this.articles = config.articles || [];
                this.isLoading = false;
            }

            renderBody() {
                if (this.isLoading) {
                    return `
                        <div class="quote-loading">
                            <p><i class="fas fa-spinner fa-spin spinner"></i> Загрузка новостей...</p>
                        </div>
                    `;
                }
                
                if (this.articles.length === 0) {
                    return `
                        <div class="news-container">
                            <p>Новости не загружены</p>
                            <button class="btn" style="margin-top: 15px;">
                                <i class="fas fa-sync-alt"></i> <span>Загрузить новости</span>
                            </button>
                        </div>
                    `;
                }
                
                const articlesHtml = this.articles.map(article => `
                    <div class="news-item">
                        <div class="news-title">${article.title}</div>
                        <div class="news-description">${article.description}</div>
                        <div class="news-source">${article.source}</div>
                    </div>
                `).join('');
                
                return `
                    <div class="news-container">
                        ${articlesHtml}
                        <button class="btn" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-sync-alt"></i> <span>Обновить новости</span>
                        </button>
                    </div>
                `;
            }

            bindEvents() {
                super.bindEvents();
                
                const refreshBtn = this.element?.querySelector('.btn');
                if (refreshBtn) {
                    this.addListener(refreshBtn, 'click', () => this.fetchNews());
                }
                
                // Загружаем новости при создании виджета
                if (this.articles.length === 0) {
                    this.fetchNews();
                }
            }

            async fetchNews() {
                this.isLoading = true;
                this.update();
                
                try {
                    // В реальном приложении здесь был бы fetch запрос к News API
                    // Для демонстрации используем мок-данные
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const mockArticles = [
                        {
                            title: "Технологии искусственного интеллекта развиваются рекордными темпами",
                            description: "Новые исследования в области машинного обучения обещают революционные изменения в различных отраслях промышленности.",
                            source: "TechNews"
                        },
                        {
                            title: "Ученые обнаружили новый метод борьбы с изменением климата",
                            description: "Инновационный подход к улавливанию углекислого газа может значительно замедлить глобальное потепление.",
                            source: "Science Daily"
                        },
                        {
                            title: "Финансовые рынки демонстрируют устойчивый рост",
                            description: "Эксперты отмечают положительную динамику на основных мировых биржах несмотря на глобальные вызовы.",
                            source: "Finance Times"
                        },
                        {
                            title: "Космическая миссия достигла новых рубежей в исследовании Марса",
                            description: "Автоматическая станция передала уникальные данные о геологии Красной планеты.",
                            source: "Space Explorer"
                        }
                    ];
                    
                    this.articles = mockArticles;
                } catch (error) {
                    console.error('Ошибка загрузки новостей:', error);
                    this.articles = [{
                        title: "Ошибка загрузки новостей",
                        description: "Пожалуйста, попробуйте обновить позже",
                        source: "Система"
                    }];
                } finally {
                    this.isLoading = false;
                    this.update();
                }
            }

            getState() {
                return {
                    type: 'news',
                    articles: this.articles
                };
            }
        }

        // Класс дашборда
        class Dashboard {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                if (!this.container) {
                    console.error('Контейнер для виджетов не найден!');
                    return;
                }
                
                this.widgets = new Map();
                this.widgetCounter = {
                    todo: 1,
                    quote: 1,
                    weather: 1,
                    news: 1
                };
                
                // Восстанавливаем состояние из localStorage
                this.restoreState();
                
                // Инициализируем статус
                this.updateDashboardStatus();
            }

            // Добавление виджета по типу
            addWidget(widgetType, config = {}) {
                let widget;
                const widgetId = config.id || `${widgetType}-${this.widgetCounter[widgetType]++}`;
                
                switch (widgetType) {
                    case 'todo':
                        config.title = config.title || `Список дел ${this.widgetCounter.todo}`;
                        widget = new ToDoWidget({ id: widgetId, ...config });
                        break;
                    case 'quote':
                        config.title = config.title || `Цитаты ${this.widgetCounter.quote}`;
                        widget = new QuoteWidget({ id: widgetId, ...config });
                        break;
                    case 'weather':
                        config.title = config.title || `Погода ${this.widgetCounter.weather}`;
                        widget = new WeatherWidget({ id: widgetId, ...config });
                        break;
                    case 'news':
                        config.title = config.title || `Новости ${this.widgetCounter.news}`;
                        widget = new NewsWidget({ id: widgetId, ...config });
                        break;
                    default:
                        console.error('Неизвестный тип виджета:', widgetType);
                        return null;
                }
                
                // Устанавливаем обработчик удаления
                widget.onDestroy = (id) => this.removeWidget(id);
                
                // Добавляем в коллекцию и DOM
                this.widgets.set(widget.id, widget);
                const widgetElement = widget.render();
                if (widgetElement) {
                    this.container.appendChild(widgetElement);
                }
                
                // Обновляем состояние дашборда
                this.updateEmptyState();
                this.saveState();
                this.updateDashboardStatus();
                
                return widget;
            }

            // Удаление виджета по ID
            removeWidget(widgetId) {
                const widget = this.widgets.get(widgetId);
                if (widget) {
                    widget.destroy();
                    this.widgets.delete(widgetId);
                    this.updateEmptyState();
                    this.saveState();
                    this.updateDashboardStatus();
                }
            }

            // Удаление всех виджетов
            removeAllWidgets() {
                this.widgets.forEach(widget => widget.destroy());
                this.widgets.clear();
                this.updateEmptyState();
                this.saveState();
                this.updateDashboardStatus();
            }

            // Обновление состояния при пустом дашборде
            updateEmptyState() {
                const emptyState = document.getElementById('emptyState');
                if (emptyState) {
                    if (this.widgets.size === 0) {
                        emptyState.style.display = 'block';
                    } else {
                        emptyState.style.display = 'none';
                    }
                }
            }

            // Обновление статуса дашборда
            updateDashboardStatus() {
                const statusElement = document.getElementById('dashboardStatus');
                if (statusElement) {
                    if (this.widgets.size === 0) {
                        statusElement.textContent = 'Пустой';
                        statusElement.style.color = 'var(--warning-color)';
                    } else if (this.widgets.size < 3) {
                        statusElement.textContent = 'Минимальный';
                        statusElement.style.color = 'var(--warning-color)';
                    } else {
                        statusElement.textContent = 'Активно';
                        statusElement.style.color = 'var(--success-color)';
                    }
                }
            }

            // Сохранение состояния в localStorage
            saveState() {
                const state = {
                    widgets: [],
                    widgetCounter: this.widgetCounter
                };
                
                this.widgets.forEach(widget => {
                    if (widget.getState) {
                        state.widgets.push({
                            type: widget.constructor.name.replace('Widget', '').toLowerCase(),
                            config: widget.getState(),
                            id: widget.id
                        });
                    }
                });
                
                try {
                    localStorage.setItem('dashboardState', JSON.stringify(state));
                    this.showSaveNotification();
                } catch (error) {
                    console.error('Ошибка сохранения состояния:', error);
                }
            }

            // Показать уведомление о сохранении
            showSaveNotification() {
                const notification = document.createElement('div');
                notification.innerHTML = '<i class="fas fa-check"></i> Сохранено';
                notification.style.position = 'fixed';
                notification.style.bottom = '100px';
                notification.style.right = '30px';
                notification.style.background = 'var(--gradient-secondary)';
                notification.style.color = 'white';
                notification.style.padding = '12px 20px';
                notification.style.borderRadius = 'var(--border-radius-sm)';
                notification.style.boxShadow = 'var(--shadow-lg)';
                notification.style.zIndex = '1000';
                notification.style.fontWeight = '600';
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(20px)';
                notification.style.transition = 'all 0.3s ease';
                
                document.body.appendChild(notification);
                
                // Анимация появления
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateY(0)';
                }, 10);
                
                // Автоматическое скрытие
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 2000);
            }

            // Восстановление состояния из localStorage
            restoreState() {
                const savedState = localStorage.getItem('dashboardState');
                if (!savedState) return;
                
                try {
                    const state = JSON.parse(savedState);
                    this.widgetCounter = state.widgetCounter || this.widgetCounter;
                    
                    if (state.widgets && Array.isArray(state.widgets)) {
                        state.widgets.forEach(widgetData => {
                            this.addWidget(widgetData.type, {
                                id: widgetData.id,
                                ...widgetData.config
                            });
                        });
                    }
                } catch (error) {
                    console.error('Ошибка восстановления состояния:', error);
                }
            }
        }

        // Главный файл приложения
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM загружен, инициализируем дашборд...');
            
            // Создаем экземпляр дашборда
            const dashboard = new Dashboard('widgetsContainer');
            
            // Проверяем, что кнопки существуют
            const addTodoBtn = document.getElementById('addTodoBtn');
            const addQuoteBtn = document.getElementById('addQuoteBtn');
            const addWeatherBtn = document.getElementById('addWeatherBtn');
            const addNewsBtn = document.getElementById('addNewsBtn');
            const removeAllBtn = document.getElementById('removeAllBtn');
            const saveDashboardBtn = document.getElementById('saveDashboardBtn');
            const helpBtn = document.getElementById('helpBtn');
            
            console.log('Кнопки найдены:', {
                addTodoBtn: !!addTodoBtn,
                addQuoteBtn: !!addQuoteBtn,
                addWeatherBtn: !!addWeatherBtn,
                addNewsBtn: !!addNewsBtn,
                removeAllBtn: !!removeAllBtn
            });
            
            // Обработчики для кнопок добавления виджетов
            if (addTodoBtn) {
                addTodoBtn.addEventListener('click', () => {
                    console.log('Добавляем виджет ToDo');
                    dashboard.addWidget('todo');
                });
            }
            
            if (addQuoteBtn) {
                addQuoteBtn.addEventListener('click', () => {
                    console.log('Добавляем виджет Quote');
                    dashboard.addWidget('quote');
                });
            }
            
            if (addWeatherBtn) {
                addWeatherBtn.addEventListener('click', () => {
                    console.log('Добавляем виджет Weather');
                    dashboard.addWidget('weather');
                });
            }
            
            if (addNewsBtn) {
                addNewsBtn.addEventListener('click', () => {
                    console.log('Добавляем виджет News');
                    dashboard.addWidget('news');
                });
            }
            
            // Обработчик для удаления всех виджетов
            if (removeAllBtn) {
                removeAllBtn.addEventListener('click', () => {
                    if (dashboard.widgets.size > 0) {
                        if (confirm('Вы уверены, что хотите удалить все виджеты? Это действие нельзя отменить.')) {
                            dashboard.removeAllWidgets();
                        }
                    } else {
                        alert('Нет виджетов для удаления.');
                    }
                });
            }
            
            // Обработчик для сохранения дашборда
            if (saveDashboardBtn) {
                saveDashboardBtn.addEventListener('click', () => {
                    alert('Функция сохранения скриншота будет реализована в следующей версии.');
                });
            }
            
            // Обработчик для кнопки помощи
            if (helpBtn) {
                helpBtn.addEventListener('click', () => {
                    alert(`Клавиатурные сокращения:
Ctrl+1 - Добавить список дел
Ctrl+2 - Добавить цитаты
Ctrl+3 - Добавить погоду
Ctrl+4 - Добавить новости
Ctrl+D - Удалить все виджеты

Перетаскивание: Удерживайте и перетаскивайте виджеты для изменения их порядка

Все данные сохраняются автоматически в вашем браузере.`);
                });
            }
            
            // Добавляем несколько виджетов по умолчанию для демонстрации
            if (dashboard.widgets.size === 0) {
                console.log('Добавляем демо-виджеты...');
                // Добавляем по одному виджету каждого типа для демонстрации
                setTimeout(() => {
                    dashboard.addWidget('todo', {
                        title: 'Мои задачи',
                        tasks: [
                            { id: 1, text: 'Изучить ООП в JavaScript', completed: true },
                            { id: 2, text: 'Создать дашборд с виджетами', completed: true },
                            { id: 3, text: 'Протестировать функционал', completed: false },
                            { id: 4, text: 'Добавить анимации', completed: false }
                        ],
                        nextTaskId: 5
                    });
                    
                    dashboard.addWidget('quote', {
                        title: 'Вдохновение на день'
                    });
                    
                    dashboard.addWidget('weather', {
                        title: 'Погода в Москве',
                        city: 'Москва'
                    });
                    
                    dashboard.addWidget('news', {
                        title: 'Последние новости'
                    });
                }, 500);
            }
            
            // Функция для обновления счетчика виджетов
            const updateWidgetCount = () => {
                const widgetCountElement = document.getElementById('widgetCount');
                if (widgetCountElement) {
                    widgetCountElement.textContent = dashboard.widgets.size;
                }
            };
            
            // Инициализируем счетчик
            updateWidgetCount();
            
            // Добавляем клавиатурные сокращения
            document.addEventListener('keydown', (e) => {
                // Ctrl+1 - добавить ToDo
                if (e.ctrlKey && e.key === '1') {
                    e.preventDefault();
                    dashboard.addWidget('todo');
                }
                // Ctrl+2 - добавить Quote
                else if (e.ctrlKey && e.key === '2') {
                    e.preventDefault();
                    dashboard.addWidget('quote');
                }
                // Ctrl+3 - добавить Weather
                else if (e.ctrlKey && e.key === '3') {
                    e.preventDefault();
                    dashboard.addWidget('weather');
                }
                // Ctrl+4 - добавить News
                else if (e.ctrlKey && e.key === '4') {
                    e.preventDefault();
                    dashboard.addWidget('news');
                }
                // Ctrl+D - удалить все
                else if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    if (dashboard.widgets.size > 0) {
                        if (confirm('Удалить все виджеты?')) {
                            dashboard.removeAllWidgets();
                        }
                    }
                }
            });
            
            console.log('Дашборд инициализирован успешно!');
        });
    </script>
    
</body>
</html>